<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Analiza UTM </title>
  <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Titillium Web', sans-serif;
      background-color: #0f0f0f;
      color: #f1f1f1;
      padding: 40px;
    }

    h1, h2 {
      color: #fff200;
      margin-bottom: 10px;
    }

    textarea {
      width: 100%;
      max-width: 960px;
      height: 240px;
      font-size: 16px;
      padding: 12px;
      border: 2px solid #fff200;
      border-radius: 4px;
      background-color: #1c1c1c;
      color: #f1f1f1;
      resize: vertical;
    }

    button {
      margin-top: 15px;
      background-color: #fff200;
      border: none;
      color: #0f0f0f;
      font-weight: bold;
      font-size: 16px;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #e5d300;
    }

    pre {
      white-space: pre-wrap;
      background-color: #1c1c1c;
      border: 1px solid #333;
      padding: 16px;
      max-width: 960px;
      border-left: 4px solid #fff200;
      border-radius: 4px;
      margin-bottom: 30px;
      overflow-x: auto;
    }

    .missing {
      color: #ff4d4d;
      font-weight: bold;
    }

    .ok {
      color: #a0ffa0;
    }
  </style>
</head>
<body>

  <h1>ğŸ”§ Analizator linkÃ³w i UTM </h1>

  <textarea id="htmlInput" placeholder="Wklej tutaj kod HTML maila..."></textarea>
  <br>
  <button onclick="analyzeHTML()">ğŸ” Analizuj linki</button>

  <h2>â— Linki mediaexpert.pl z brakujÄ…cymi UTM lub zÅ‚Ä… strukturÄ…:</h2>
  <pre id="missingLinks"></pre>

  <h2>ğŸ”— Wszystkie linki z analizÄ… UTM:</h2>
  <pre id="allLinks"></pre>

  <script>
    function analyzeHTML() {
      const html = document.getElementById("htmlInput").value;
      const missingOutput = document.getElementById("missingLinks");
      const allOutput = document.getElementById("allLinks");
      missingOutput.textContent = "";
      allOutput.textContent = "";

      if (!html.trim()) {
        missingOutput.textContent = "âš ï¸ Wklej kod HTML maila.";
        return;
      }

      const doc = new DOMParser().parseFromString(html, "text/html");
      const links = Array.from(doc.querySelectorAll("a[href]"));

      if (links.length === 0) {
        missingOutput.textContent = "âŒ Nie znaleziono Å¼adnych linkÃ³w.";
        return;
      }

      const requiredUTMs = ['utm_source', 'utm_medium', 'utm_campaign', 'utm_content'];
      const missingList = [];
      const allList = [];

      links.forEach(link => {
        const linkText = link.textContent.trim();

        // PomiÅ„ linki zawierajÄ…ce tekst "OtwÃ³rz w przeglÄ…darce"
        if (linkText.includes("OtwÃ³rz w przeglÄ…darce")) {
          return;
        }

        const href = link.getAttribute('href');
        let parsedURL;
        try {
          parsedURL = new URL(href);
        } catch (e) {
          allList.push(`âš ï¸ NieprawidÅ‚owy link (bÅ‚Ä…d URL): ${href}\n`);
          missingList.push(`âš ï¸ NieprawidÅ‚owy link (bÅ‚Ä…d URL): ${href}\n`);
          return;
        }

        const url = parsedURL;
        const hostname = url.hostname.replace(/^www\./, '');
        const isMediaExpert = hostname.includes("mediaexpert.pl");

        const hasDoubleQuery = url.href.includes('?') && url.href.split('?').length > 2;
        const missingUTM = requiredUTMs.filter(param => !url.searchParams.has(param));
        const utmDetails = requiredUTMs.map(param => {
          const value = url.searchParams.get(param) || 'BRAK';
          return `   - ${param}: ${value}`;
        }).join('\n');

        const result = `â¡ï¸ ${url.href}\n${utmDetails}\n`;

        if ((isMediaExpert && missingUTM.length > 0) || hasDoubleQuery) {
          missingList.push(result);
        }

        allList.push(result);
      });

      if (missingList.length === 0) {
        missingOutput.textContent = "âœ… Wszystkie linki mediaexpert.pl majÄ… kompletne UTM i poprawnÄ… strukturÄ™.";
      } else {
        missingOutput.innerHTML = '<span class="missing">' + missingList.join('\n') + '</span>';
      }

      allOutput.textContent = allList.join('\n');
    }
  </script>

</body>
</html>
